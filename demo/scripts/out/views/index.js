// Generated by CoffeeScript 1.4.0
(function() {

  client.views.index = Backbone.View.extend({
    build: function() {
      var nextMonths, that;
      that = this;
      nextMonths = RJS.range(0, 11).map(function(n) {
        return Date.today().moveToFirstDayOfMonth().add({
          month: n
        });
      });
      return [
        '#page-index', [
          [
            '.container', [
              ['heading.cf', [['h1#owner', 'Raine'], ['h2#year', '2013']]], [
                '.events', nextMonths.map(function(month) {
                  return new client.partials.Month({
                    model: new Backbone.Model({
                      month: month,
                      events: that.model.get('events')
                    })
                  });
                })
              ]
            ]
          ]
        ]
      ];
    }
  });

  client.partials.Month = Backbone.View.extend({
    tagName: 'span',
    build: function() {
      var that, thisMonthsEvents;
      that = this;
      thisMonthsEvents = this.model.get('events').filter(function(event) {
        return Date.parse(event.start).getMonth() === that.model.get('month').getMonth();
      });
      return [
        '.month', thisMonthsEvents.map(function(event) {
          return new client.partials.Event({
            model: new Backbone.Model(event)
          });
        })
      ];
    }
  });

  client.partials.Event = Backbone.View.extend({
    build: function() {
      var endDate, endOfMonth, left, startDate, width;
      startDate = Date.parse(this.model.get('start'));
      endDate = Date.parse(this.model.get('end'));
      endOfMonth = startDate.clone().moveToLastDayOfMonth();
      left = startDate.getDate() / endOfMonth.getDate() * 100;
      width = (endDate.getDate() - startDate.getDate()) / endOfMonth.getDate() * 100;
      return [
        '.event', {
          style: 'margin-left: {0}%; width: {1}%'.supplant([left, width])
        }, [['.details', [['.title', this.model.get('title')], ['.date', '{0} to {1}'.supplant([this.model.get('start'), this.model.get('end')])]]]]
      ];
    }
  });

}).call(this);
